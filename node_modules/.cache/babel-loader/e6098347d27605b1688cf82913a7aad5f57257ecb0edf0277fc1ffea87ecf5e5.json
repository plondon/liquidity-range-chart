{"ast":null,"code":"var _jsxFileName = \"/Users/phil.london/Projects/tradingview-chart-mvp/src/Brush.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Brush = ({\n  yScale,\n  interactive = true,\n  brushExtent,\n  setBrushExtent,\n  width,\n  height\n}) => {\n  _s();\n  const brushRef = useRef(null);\n  const brushBehavior = useRef(null);\n  const brushInProgressRef = useRef(false);\n\n  // Convert [minPrice, maxPrice] to [yMax, yMin] for D3 brush (reversed because SVG y-axis)\n  const toYScale = extent => {\n    if (!extent || extent.length !== 2) return null;\n    // extent[0] = minPrice -> bottom of selection (higher y value)\n    // extent[1] = maxPrice -> top of selection (lower y value)\n    return [yScale(extent[1]), yScale(extent[0])];\n  };\n\n  // Convert [yMax, yMin] to [minPrice, maxPrice]\n  const toPriceExtent = selection => {\n    if (!selection || selection.length !== 2) return null;\n    // selection[0] = top y position -> maxPrice\n    // selection[1] = bottom y position -> minPrice\n    return [yScale.invert(selection[1]), yScale.invert(selection[0])];\n  };\n\n  // Initialize the brush\n  useEffect(() => {\n    if (!brushRef.current || !yScale) return;\n    brushBehavior.current = d3.brushY().extent([[0, 2],\n    // top left with small margin\n    [width, height - 2] // bottom right with small margin\n    ]).filter(() => interactive).on('brush', event => {\n      const {\n        selection\n      } = event;\n      brushInProgressRef.current = true;\n      if (!selection) {\n        setLocalBrushExtent(null);\n        return;\n      }\n\n      // Update only the local extent during dragging\n      const priceExtent = normalizeExtent(toPriceExtent(selection));\n      setLocalBrushExtent(priceExtent);\n    }).on('end', event => {\n      const {\n        selection\n      } = event;\n      brushInProgressRef.current = false;\n      if (!selection) {\n        setBrushExtent(null);\n        setLocalBrushExtent(null);\n        return;\n      }\n\n      // Finalize state update on end\n      const priceExtent = normalizeExtent(toPriceExtent(selection));\n      setBrushExtent(priceExtent);\n      setLocalBrushExtent(priceExtent);\n    });\n\n    // Apply brush behavior to the SVG group\n    d3.select(brushRef.current).call(brushBehavior.current);\n\n    // Set initial brush position\n    if (scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current).transition().call(brushBehavior.current.move, scaledExtent);\n    }\n\n    // Style the brush with more visible styling\n    d3.select(brushRef.current).selectAll('.selection').attr('stroke', '#2196F3').attr('stroke-width', 2).attr('fill', '#2196F3').attr('fill-opacity', 0.3).attr('cursor', 'grab').style('visibility', 'visible');\n    d3.select(brushRef.current).selectAll('.handle').attr('fill', '#2196F3').attr('stroke', '#2196F3').attr('stroke-width', 2).attr('cursor', 'ns-resize').style('visibility', hideHandles ? 'hidden' : 'visible');\n\n    // Make sure overlay is clickable\n    d3.select(brushRef.current).selectAll('.overlay').attr('cursor', 'crosshair').attr('fill', 'none').attr('pointer-events', 'all');\n  }, [yScale, width, height, interactive, setBrushExtent]);\n\n  // Respond to external brush extent changes\n  useEffect(() => {\n    if (!brushRef.current || !brushBehavior.current || !yScale || brushInProgressRef.current) {\n      return;\n    }\n    const normalizedExtent = normalizeExtent(brushExtent);\n    if (!normalizedExtent) {\n      d3.select(brushRef.current).call(brushBehavior.current.clear);\n      return;\n    }\n    const scaledExtent = toYScale(normalizedExtent);\n    if (scaledExtent && scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current).call(brushBehavior.current.move, scaledExtent);\n    }\n  }, [brushExtent, yScale]);\n  return /*#__PURE__*/_jsxDEV(\"g\", {\n    ref: brushRef\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 126,\n    columnNumber: 10\n  }, this);\n};\n_s(Brush, \"L5tUK6IlY8wnQbY7uKg9OVVHTZE=\");\n_c = Brush;\nexport default Brush;\nvar _c;\n$RefreshReg$(_c, \"Brush\");","map":{"version":3,"names":["React","useEffect","useRef","useState","d3","jsxDEV","_jsxDEV","Brush","yScale","interactive","brushExtent","setBrushExtent","width","height","_s","brushRef","brushBehavior","brushInProgressRef","toYScale","extent","length","toPriceExtent","selection","invert","current","brushY","filter","on","event","setLocalBrushExtent","priceExtent","normalizeExtent","select","call","scaledExtent","transition","move","selectAll","attr","style","hideHandles","normalizedExtent","clear","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/phil.london/Projects/tradingview-chart-mvp/src/Brush.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\n\nconst Brush = ({\n  yScale,\n  interactive = true,\n  brushExtent,\n  setBrushExtent,\n  width,\n  height,\n}) => {\n  const brushRef = useRef(null);\n  const brushBehavior = useRef(null);\n  const brushInProgressRef = useRef(false);\n\n  // Convert [minPrice, maxPrice] to [yMax, yMin] for D3 brush (reversed because SVG y-axis)\n  const toYScale = (extent) => {\n    if (!extent || extent.length !== 2) return null;\n    // extent[0] = minPrice -> bottom of selection (higher y value)\n    // extent[1] = maxPrice -> top of selection (lower y value)\n    return [yScale(extent[1]), yScale(extent[0])];\n  };\n\n  // Convert [yMax, yMin] to [minPrice, maxPrice]\n  const toPriceExtent = (selection) => {\n    if (!selection || selection.length !== 2) return null;\n    // selection[0] = top y position -> maxPrice\n    // selection[1] = bottom y position -> minPrice\n    return [yScale.invert(selection[1]), yScale.invert(selection[0])];\n  };\n\n  // Initialize the brush\n  useEffect(() => {\n    if (!brushRef.current || !yScale) return;\n\n    brushBehavior.current = d3.brushY()\n      .extent([\n        [0, 2], // top left with small margin\n        [width, height - 2], // bottom right with small margin\n      ])\n      .filter(() => interactive)\n      .on('brush', (event) => {\n        const { selection } = event;\n        brushInProgressRef.current = true;\n\n        if (!selection) {\n          setLocalBrushExtent(null);\n          return;\n        }\n\n        // Update only the local extent during dragging\n        const priceExtent = normalizeExtent(toPriceExtent(selection));\n        setLocalBrushExtent(priceExtent);\n      })\n      .on('end', (event) => {\n        const { selection } = event;\n        brushInProgressRef.current = false;\n\n        if (!selection) {\n          setBrushExtent(null);\n          setLocalBrushExtent(null);\n          return;\n        }\n\n        // Finalize state update on end\n        const priceExtent = normalizeExtent(toPriceExtent(selection));\n        setBrushExtent(priceExtent);\n        setLocalBrushExtent(priceExtent);\n      });\n\n    // Apply brush behavior to the SVG group\n    d3.select(brushRef.current).call(brushBehavior.current);\n\n    // Set initial brush position\n    if (scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current)\n        .transition()\n        .call(brushBehavior.current.move, scaledExtent);\n    }\n\n    // Style the brush with more visible styling\n    d3.select(brushRef.current)\n      .selectAll('.selection')\n      .attr('stroke', '#2196F3')\n      .attr('stroke-width', 2)\n      .attr('fill', '#2196F3')\n      .attr('fill-opacity', 0.3)\n      .attr('cursor', 'grab')\n      .style('visibility', 'visible');\n\n    d3.select(brushRef.current)\n      .selectAll('.handle')\n      .attr('fill', '#2196F3')\n      .attr('stroke', '#2196F3')\n      .attr('stroke-width', 2)\n      .attr('cursor', 'ns-resize')\n      .style('visibility', hideHandles ? 'hidden' : 'visible');\n\n    // Make sure overlay is clickable\n    d3.select(brushRef.current)\n      .selectAll('.overlay')\n      .attr('cursor', 'crosshair')\n      .attr('fill', 'none')\n      .attr('pointer-events', 'all');\n\n  }, [yScale, width, height, interactive, setBrushExtent]);\n\n  // Respond to external brush extent changes\n  useEffect(() => {\n    if (!brushRef.current || !brushBehavior.current || !yScale || brushInProgressRef.current) {\n      return;\n    }\n\n    const normalizedExtent = normalizeExtent(brushExtent);\n    if (!normalizedExtent) {\n      d3.select(brushRef.current).call(brushBehavior.current.clear);\n      return;\n    }\n\n    const scaledExtent = toYScale(normalizedExtent);\n    if (scaledExtent && scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current).call(brushBehavior.current.move, scaledExtent);\n    }\n  }, [brushExtent, yScale]);\n\n  return <g ref={brushRef} />;\n};\n\nexport default Brush;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}