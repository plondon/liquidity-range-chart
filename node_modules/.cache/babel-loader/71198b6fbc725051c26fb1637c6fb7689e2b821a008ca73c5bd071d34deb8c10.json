{"ast":null,"code":"var _jsxFileName = \"/Users/phil.london/Projects/tradingview-chart-mvp/src/Brush.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Brush = ({\n  yScale,\n  interactive = true,\n  brushExtent,\n  setBrushExtent,\n  hideHandles = false,\n  width,\n  height\n}) => {\n  _s();\n  const brushRef = useRef(null);\n  const brushBehavior = useRef(null);\n  const [localBrushExtent, setLocalBrushExtent] = useState(brushExtent);\n  const brushInProgressRef = useRef(false);\n\n  // Convert [minPrice, maxPrice] to [yMax, yMin] for D3 brush\n  const toYScale = extent => {\n    if (!extent || extent.length !== 2) return null;\n    return [yScale(extent[1]), yScale(extent[0])];\n  };\n\n  // Convert [yMax, yMin] to [minPrice, maxPrice]\n  const toPriceExtent = selection => {\n    if (!selection || selection.length !== 2) return null;\n    return [yScale.invert(selection[1]), yScale.invert(selection[0])];\n  };\n  const normalizeExtent = extent => {\n    if (!extent || extent.length !== 2) return null;\n    return extent[0] < extent[1] ? extent : [extent[1], extent[0]];\n  };\n\n  // Keep local and external brush extent in sync\n  useEffect(() => {\n    if (brushInProgressRef.current) {\n      return;\n    }\n    setLocalBrushExtent(brushExtent);\n  }, [brushExtent]);\n\n  // Initialize the brush\n  useEffect(() => {\n    if (!brushRef.current || !yScale) return;\n    const normalizedExtent = normalizeExtent(brushExtent);\n    if (!normalizedExtent) return;\n    const scaledExtent = toYScale(normalizedExtent);\n    if (!scaledExtent) return;\n    brushBehavior.current = d3.brushY().extent([[0, 2],\n    // top left with small margin\n    [width, height - 2] // bottom right with small margin\n    ]).filter(() => interactive).on('brush', event => {\n      const {\n        selection\n      } = event;\n      brushInProgressRef.current = true;\n      if (!selection) {\n        setLocalBrushExtent(null);\n        return;\n      }\n\n      // Update only the local extent during dragging\n      const priceExtent = normalizeExtent(toPriceExtent(selection));\n      setLocalBrushExtent(priceExtent);\n    }).on('end', event => {\n      const {\n        selection\n      } = event;\n      brushInProgressRef.current = false;\n      if (!selection) {\n        setBrushExtent(null);\n        setLocalBrushExtent(null);\n        return;\n      }\n\n      // Finalize state update on end\n      const priceExtent = normalizeExtent(toPriceExtent(selection));\n      setBrushExtent(priceExtent);\n      setLocalBrushExtent(priceExtent);\n    });\n\n    // Apply brush behavior to the SVG group\n    d3.select(brushRef.current).call(brushBehavior.current);\n\n    // Set initial brush position\n    if (scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current).transition().call(brushBehavior.current.move, scaledExtent);\n    }\n\n    // Style the brush with more visible styling\n    d3.select(brushRef.current).selectAll('.selection').attr('stroke', '#2196F3').attr('stroke-width', 2).attr('fill', '#2196F3').attr('fill-opacity', 0.3).attr('cursor', 'grab').style('visibility', 'visible');\n    d3.select(brushRef.current).selectAll('.handle').attr('fill', '#2196F3').attr('stroke', '#2196F3').attr('stroke-width', 2).attr('cursor', 'ns-resize').style('visibility', 'visible');\n\n    // Make sure overlay is clickable\n    d3.select(brushRef.current).selectAll('.overlay').attr('cursor', 'crosshair').attr('fill', 'none').attr('pointer-events', 'all');\n  }, [yScale, width, height, interactive, setBrushExtent]);\n\n  // Respond to external brush extent changes\n  useEffect(() => {\n    if (!brushRef.current || !brushBehavior.current || !yScale || brushInProgressRef.current) {\n      return;\n    }\n    const normalizedExtent = normalizeExtent(brushExtent);\n    if (!normalizedExtent) {\n      d3.select(brushRef.current).call(brushBehavior.current.clear);\n      return;\n    }\n    const scaledExtent = toYScale(normalizedExtent);\n    if (scaledExtent && scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current).call(brushBehavior.current.move, scaledExtent);\n    }\n  }, [brushExtent, yScale]);\n  return /*#__PURE__*/_jsxDEV(\"g\", {\n    ref: brushRef\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 143,\n    columnNumber: 10\n  }, this);\n};\n_s(Brush, \"AMYf+R+VgNLr1eZoTbxa+kADaps=\");\n_c = Brush;\nexport default Brush;\nvar _c;\n$RefreshReg$(_c, \"Brush\");","map":{"version":3,"names":["React","useEffect","useRef","useState","d3","jsxDEV","_jsxDEV","Brush","yScale","interactive","brushExtent","setBrushExtent","hideHandles","width","height","_s","brushRef","brushBehavior","localBrushExtent","setLocalBrushExtent","brushInProgressRef","toYScale","extent","length","toPriceExtent","selection","invert","normalizeExtent","current","normalizedExtent","scaledExtent","brushY","filter","on","event","priceExtent","select","call","transition","move","selectAll","attr","style","clear","ref","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/phil.london/Projects/tradingview-chart-mvp/src/Brush.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\n\nconst Brush = ({\n  yScale,\n  interactive = true,\n  brushExtent,\n  setBrushExtent,\n  hideHandles = false,\n  width,\n  height,\n}) => {\n  const brushRef = useRef(null);\n  const brushBehavior = useRef(null);\n  const [localBrushExtent, setLocalBrushExtent] = useState(brushExtent);\n  const brushInProgressRef = useRef(false);\n\n  // Convert [minPrice, maxPrice] to [yMax, yMin] for D3 brush\n  const toYScale = (extent) => {\n    if (!extent || extent.length !== 2) return null;\n    return [yScale(extent[1]), yScale(extent[0])];\n  };\n\n  // Convert [yMax, yMin] to [minPrice, maxPrice]\n  const toPriceExtent = (selection) => {\n    if (!selection || selection.length !== 2) return null;\n    return [yScale.invert(selection[1]), yScale.invert(selection[0])];\n  };\n\n  const normalizeExtent = (extent) => {\n    if (!extent || extent.length !== 2) return null;\n    return extent[0] < extent[1] ? extent : [extent[1], extent[0]];\n  };\n\n  // Keep local and external brush extent in sync\n  useEffect(() => {\n    if (brushInProgressRef.current) {\n      return;\n    }\n    setLocalBrushExtent(brushExtent);\n  }, [brushExtent]);\n\n  // Initialize the brush\n  useEffect(() => {\n    if (!brushRef.current || !yScale) return;\n\n    const normalizedExtent = normalizeExtent(brushExtent);\n    if (!normalizedExtent) return;\n\n    const scaledExtent = toYScale(normalizedExtent);\n    if (!scaledExtent) return;\n\n    brushBehavior.current = d3.brushY()\n      .extent([\n        [0, 2], // top left with small margin\n        [width, height - 2], // bottom right with small margin\n      ])\n      .filter(() => interactive)\n      .on('brush', (event) => {\n        const { selection } = event;\n        brushInProgressRef.current = true;\n\n        if (!selection) {\n          setLocalBrushExtent(null);\n          return;\n        }\n\n        // Update only the local extent during dragging\n        const priceExtent = normalizeExtent(toPriceExtent(selection));\n        setLocalBrushExtent(priceExtent);\n      })\n      .on('end', (event) => {\n        const { selection } = event;\n        brushInProgressRef.current = false;\n\n        if (!selection) {\n          setBrushExtent(null);\n          setLocalBrushExtent(null);\n          return;\n        }\n\n        // Finalize state update on end\n        const priceExtent = normalizeExtent(toPriceExtent(selection));\n        setBrushExtent(priceExtent);\n        setLocalBrushExtent(priceExtent);\n      });\n\n    // Apply brush behavior to the SVG group\n    d3.select(brushRef.current).call(brushBehavior.current);\n\n    // Set initial brush position\n    if (scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current)\n        .transition()\n        .call(brushBehavior.current.move, scaledExtent);\n    }\n\n    // Style the brush with more visible styling\n    d3.select(brushRef.current)\n      .selectAll('.selection')\n      .attr('stroke', '#2196F3')\n      .attr('stroke-width', 2)\n      .attr('fill', '#2196F3')\n      .attr('fill-opacity', 0.3)\n      .attr('cursor', 'grab')\n      .style('visibility', 'visible');\n\n    d3.select(brushRef.current)\n      .selectAll('.handle')\n      .attr('fill', '#2196F3')\n      .attr('stroke', '#2196F3')\n      .attr('stroke-width', 2)\n      .attr('cursor', 'ns-resize')\n      .style('visibility', 'visible');\n\n    // Make sure overlay is clickable\n    d3.select(brushRef.current)\n      .selectAll('.overlay')\n      .attr('cursor', 'crosshair')\n      .attr('fill', 'none')\n      .attr('pointer-events', 'all');\n\n  }, [yScale, width, height, interactive, setBrushExtent]);\n\n  // Respond to external brush extent changes\n  useEffect(() => {\n    if (!brushRef.current || !brushBehavior.current || !yScale || brushInProgressRef.current) {\n      return;\n    }\n\n    const normalizedExtent = normalizeExtent(brushExtent);\n    if (!normalizedExtent) {\n      d3.select(brushRef.current).call(brushBehavior.current.clear);\n      return;\n    }\n\n    const scaledExtent = toYScale(normalizedExtent);\n    if (scaledExtent && scaledExtent[0] !== scaledExtent[1]) {\n      d3.select(brushRef.current).call(brushBehavior.current.move, scaledExtent);\n    }\n  }, [brushExtent, yScale]);\n\n  return <g ref={brushRef} />;\n};\n\nexport default Brush;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}